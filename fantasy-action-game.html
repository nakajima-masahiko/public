<!DOCTYPE html>

<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Forest Knight - Fantasy Side-Scroller</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{background:#0a0a12;display:flex;justify-content:center;align-items:center;min-height:100vh;font-family:'Segoe UI',sans-serif;overflow:hidden}
#gc{position:relative;width:800px;height:500px}
canvas{display:block;border:2px solid #2a1f0e;border-radius:4px;background:#000}
#ui{position:absolute;top:8px;left:10px;right:10px;display:flex;justify-content:space-between;pointer-events:none;z-index:10}
.hpw{width:160px;height:16px;background:#1a0a0a;border:2px solid #8B4513;border-radius:3px;overflow:hidden}
.hpb{height:100%;background:linear-gradient(180deg,#4CAF50,#2E7D32);transition:width .2s}
.hpb.boss{background:linear-gradient(180deg,#e53935,#b71c1c)}
.ut{color:#ffd700;font-size:13px;font-weight:bold;text-shadow:1px 1px 2px #000;margin-bottom:2px}
#bossUI{display:none;text-align:right}
#ov{position:absolute;inset:0;display:flex;flex-direction:column;justify-content:center;align-items:center;background:rgba(0,0,0,.78);z-index:20}
#ov.hidden{display:none}
#ov h1{font:42px Georgia,serif;color:#ffd700;text-shadow:0 0 20px rgba(255,215,0,.5);margin-bottom:6px}
#ov h2{font:20px Georgia,serif;color:#bbb;margin-bottom:16px}
#ov p{color:#999;font-size:13px;margin-bottom:4px}
.sb{margin-top:14px;padding:10px 36px;font:17px Georgia,serif;background:linear-gradient(180deg,#DAA520,#8B6914);color:#fff;border:2px solid #ffd700;border-radius:6px;cursor:pointer;text-shadow:1px 1px 2px #000}
.sb:hover{background:linear-gradient(180deg,#ffd700,#DAA520)}
#mc{display:none;position:absolute;bottom:10px;left:10px;right:10px;justify-content:space-between;z-index:15;pointer-events:none}
.cb{width:52px;height:52px;background:rgba(255,255,255,.15);border:2px solid rgba(255,255,255,.3);border-radius:50%;color:#fff;font-size:20px;display:flex;align-items:center;justify-content:center;pointer-events:all;user-select:none;-webkit-user-select:none}
.cg{display:flex;gap:8px}
@media(max-width:820px){#gc{width:100vw;height:60vw;max-height:500px}#mc{display:flex}}
</style>
</head>
<body>
<div id="gc">
<canvas id="cv" width="800" height="500"></canvas>
<div id="ui">
 <div>
  <div class="ut" id="stxt">SCORE: 0</div>
  <div class="ut">HP</div>
  <div class="hpw"><div class="hpb" id="php"></div></div>
 </div>
 <div id="bossUI">
  <div class="ut" id="bn">BOSS</div>
  <div class="hpw" style="width:220px"><div class="hpb boss" id="bhp"></div></div>
 </div>
 <div><div class="ut" id="sttxt">STAGE 1</div></div>
</div>
<div id="ov">
 <h1 id="ot">&#9876; Forest Knight &#9876;</h1>
 <h2 id="os">~ ファンタジー横スクロールアクション ~</h2>
 <p>&#8592; &#8594; : 移動　｜　&#8593; / Space : ジャンプ　｜　Z : 攻撃</p>
 <p>敵を倒してボスに挑め！</p>
 <button class="sb" id="sbtn">START GAME</button>
</div>
<div id="mc">
 <div class="cg">
  <div class="cb" data-k="left">&#9664;</div>
  <div class="cb" data-k="right">&#9654;</div>
 </div>
 <div class="cg">
  <div class="cb" data-k="jump">&#9650;</div>
  <div class="cb" data-k="atk">&#9876;</div>
 </div>
</div>
</div>

<script>
(function(){
"use strict";

var canvas = document.getElementById("cv");
var ctx = canvas.getContext("2d");
var W = 800, H = 500;
var GY = H - 60;

var state = "title";
var score = 0;
var stg = 1;
var MAXS = 3;
var camX = 0;
var fr = 0;
var shk = 0;
var parts = [];
var plats = [];
var ens = [];
var coins = [];
var boss = null;
var lvW = 3200;
var pl = null;
var clrT = 0;

var keys = {};
window.addEventListener("keydown", function(e){
  keys[e.key] = true;
  if(["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"," "].indexOf(e.key)>=0) e.preventDefault();
});
window.addEventListener("keyup", function(e){ keys[e.key] = false; });

var mm = {left:"ArrowLeft",right:"ArrowRight",jump:" ",atk:"z"};
document.querySelectorAll(".cb").forEach(function(b){
  var k=mm[b.dataset.k];
  if(!k) return;
  b.addEventListener("touchstart",function(e){e.preventDefault();keys[k]=true;});
  b.addEventListener("touchend",function(e){e.preventDefault();keys[k]=false;});
});

function mkPl(){
  return{x:60,y:GY-40,w:28,h:40,vx:0,vy:0,onG:false,hp:100,mhp:100,
    atk:false,atkT:0,atkCD:0,fR:true,inv:0,af:0,at:0};
}

function mkLv(s){
  plats=[];ens=[];coins=[];boss=null;camX=0;parts=[];clrT=0;
  lvW=2400+s*800;
  for(var x=0;x<lvW;x+=80){
    if(s>1&&x>400&&x<lvW-600&&Math.random()<0.07)continue;
    plats.push({x:x,y:GY,w:80,h:60,t:"g"});
  }
  var n=12+s*5;
  for(var i=0;i<n;i++){
    var px=200+Math.random()*(lvW-400);
    var py=GY-80-Math.random()*180;
    var pw=60+Math.random()*80;
    plats.push({x:px,y:py,w:pw,h:16,t:"f"});
    if(Math.random()<0.5) coins.push({x:px+pw/2-8,y:py-22,w:16,h:16,got:false});
  }
  var en=6+s*4;
  for(var i=0;i<en;i++){
    var ex=300+(i/en)*(lvW-600);
    var et=Math.random()<0.3+s*0.1?"bat":"slime";
    ens.push(mkEn(ex,et,s));
  }
  boss=mkBs(s);
}

function mkEn(x,tp,s){
  if(tp==="slime") return{tp:"slime",x:x,y:GY-24,w:28,h:24,vx:(0.5+s*0.3)*(Math.random()<0.5?1:-1),vy:0,hp:2+s,mhp:2+s,alive:true,onG:false,at:0,col:["#4CAF50","#8BC34A","#7B1FA2"][s-1]};
  return{tp:"bat",x:x,y:GY-160-Math.random()*80,w:30,h:20,vx:(0.8+s*0.3)*(Math.random()<0.5?1:-1),vy:0,hp:1+s,mhp:1+s,alive:true,at:0,ft:Math.random()*100,col:["#7B1FA2","#E91E63","#FF5722"][s-1]};
}

function mkBs(s){
  var bd=[
    {nm:"DARK TREANT",cl:"#2E7D32",sz:60,hp:25,sp:1.2,pt:"charge"},
    {nm:"SHADOW DRAKE",cl:"#4A148C",sz:70,hp:40,sp:1.4,pt:"fly"},
    {nm:"DEMON LORD",cl:"#B71C1C",sz:80,hp:60,sp:1.6,pt:"magic"}
  ];
  var b=bd[s-1];
  return{x:lvW-300,y:GY-b.sz,w:b.sz,h:b.sz,vx:-b.sp,vy:0,hp:b.hp,mhp:b.hp,alive:true,
    nm:b.nm,cl:b.cl,pt:b.pt,onG:false,tmr:0,atkT:0,inv:0,proj:[]};
}

function grav(e){
  e.vy+=0.55; e.y+=e.vy; e.onG=false;
  for(var i=0;i<plats.length;i++){
    var p=plats[i];
    if(e.x+e.w>p.x && e.x<p.x+p.w && e.y+e.h>p.y && e.y+e.h<p.y+12 && e.vy>=0){
      e.y=p.y-e.h; e.vy=0; e.onG=true;
    }
  }
  return e.y<=H+60;
}

function col(a,b){return a.x<b.x+b.w&&a.x+a.w>b.x&&a.y<b.y+b.h&&a.y+a.h>b.y;}

function addP(x,y,c,n){
  for(var i=0;i<n;i++) parts.push({x:x,y:y,vx:(Math.random()-.5)*6,vy:-Math.random()*4-1,life:25+Math.random()*20,ml:45,col:c,sz:2+Math.random()*3});
}

function swBox(){
  if(!pl.atk) return null;
  return{x:pl.fR?pl.x+pl.w:pl.x-32, y:pl.y+6, w:32, h:28};
}

function update(){
  fr++;
  if(state!=="playing") return;

  if(keys["ArrowLeft"]||keys["a"]){pl.vx=-3.8;pl.fR=false;}
  else if(keys["ArrowRight"]||keys["d"]){pl.vx=3.8;pl.fR=true;}
  else{pl.vx*=0.7;}

  if((keys["ArrowUp"]||keys[" "]||keys["w"])&&pl.onG) pl.vy=-11.5;

  if((keys["z"]||keys["Z"])&&pl.atkCD<=0){pl.atk=true;pl.atkT=10;pl.atkCD=18;}
  if(pl.atkT>0)pl.atkT--; else pl.atk=false;
  if(pl.atkCD>0)pl.atkCD--;
  if(pl.inv>0)pl.inv--;

  pl.x+=pl.vx;
  if(pl.x<0)pl.x=0;
  if(pl.x>lvW-pl.w)pl.x=lvW-pl.w;
  if(!grav(pl))pl.hp=0;

  pl.at++;
  if(pl.at>8){pl.at=0;pl.af=(pl.af+1)%4;}

  var tc=pl.x-W/3;
  camX+=(tc-camX)*0.1;
  if(camX<0)camX=0;
  if(camX>lvW-W)camX=lvW-W;

  var sb=swBox();
  var shf=pl.atkT===9;

  for(var i=0;i<ens.length;i++){
    var e=ens[i];
    if(!e.alive)continue;
    e.at++;
    if(e.tp==="slime"){
      e.x+=e.vx; grav(e);
      if(e.x<10||e.x>lvW-40)e.vx*=-1;
    }else{
      e.ft+=0.05; e.x+=e.vx; e.y+=Math.sin(e.ft)*1.4;
      if(e.x<50||e.x>lvW-50)e.vx*=-1;
    }
    if(sb&&shf&&col(sb,e)){
      e.hp--; addP(e.x+e.w/2,e.y+e.h/2,"#fff",5); shk=4;
      if(e.hp<=0){e.alive=false;score+=e.tp==="bat"?200:100;addP(e.x+e.w/2,e.y+e.h/2,e.col,12);}
    }
    if(e.alive&&pl.inv<=0&&col(pl,e)){
      pl.hp-=10;pl.inv=40;pl.vy=-5;pl.vx=pl.fR?-4:4;shk=5;
      addP(pl.x+pl.w/2,pl.y+pl.h/2,"#f44",6);
    }
  }

  if(boss&&boss.alive){
    boss.tmr++;boss.atkT++;
    if(boss.inv>0)boss.inv--;
    var dx=pl.x-boss.x;

    if(boss.pt==="charge"){
      boss.vx=dx>0?1.4:-1.4; boss.x+=boss.vx; grav(boss);
      if(boss.atkT>80&&boss.onG){boss.vy=-10;boss.atkT=0;}
    }else if(boss.pt==="fly"){
      boss.x+=dx>0?1.1:-1.1;
      boss.y=GY-boss.h-100+Math.sin(boss.tmr*0.03)*50;
      if(boss.atkT>55){
        var pdx=pl.x-boss.x,pdy=pl.y-boss.y,d=Math.sqrt(pdx*pdx+pdy*pdy)||1;
        boss.proj.push({x:boss.x+boss.w/2,y:boss.y+boss.h,vx:pdx/d*3,vy:pdy/d*3,life:100});
        boss.atkT=0;
      }
    }else if(boss.pt==="magic"){
      boss.vx=dx>0?0.9:-0.9; boss.x+=boss.vx; grav(boss);
      if(boss.atkT>35){
        for(var a=0;a<3;a++){
          var ang=-Math.PI/2+(a-1)*0.4;
          boss.proj.push({x:boss.x+boss.w/2,y:boss.y,vx:Math.cos(ang)*3,vy:Math.sin(ang)*3,life:90});
        }
        boss.atkT=0;
      }
    }

    for(var i=boss.proj.length-1;i>=0;i--){
      var p=boss.proj[i];
      p.x+=p.vx;p.y+=p.vy;p.life--;
      if(p.life<=0){boss.proj.splice(i,1);continue;}
      if(pl.inv<=0&&Math.abs(p.x-pl.x-pl.w/2)<16&&Math.abs(p.y-pl.y-pl.h/2)<16){
        pl.hp-=15;pl.inv=40;shk=5;
        addP(pl.x+pl.w/2,pl.y+pl.h/2,"#f44",6);
        boss.proj.splice(i,1);
      }
    }

    if(sb&&shf&&boss.inv<=0&&col(sb,boss)){
      boss.hp-=2;boss.inv=12;shk=5;
      addP(boss.x+boss.w/2,boss.y+boss.h/2,"#ffd700",8);
      if(boss.hp<=0){
        boss.alive=false;score+=1000*stg;
        addP(boss.x+boss.w/2,boss.y+boss.h/2,boss.cl,30);
        addP(boss.x+boss.w/2,boss.y+boss.h/2,"#ffd700",20);
        clrT=60;
      }
    }

    if(boss.alive&&pl.inv<=0&&col(pl,boss)){
      pl.hp-=20;pl.inv=50;pl.vy=-7;pl.vx=pl.fR?-6:6;shk=7;
    }

    document.getElementById("bossUI").style.display="block";
    document.getElementById("bn").textContent=boss.nm;
    document.getElementById("bhp").style.width=Math.max(0,boss.hp/boss.mhp*100)+"%";
  }

  if(boss&&!boss.alive&&clrT>0){
    clrT--;
    if(clrT<=0){
      state=stg>=MAXS?"allclear":"stageclear";
      showOv();
    }
  }

  for(var i=0;i<coins.length;i++){
    var c=coins[i];
    if(!c.got&&col(pl,c)){c.got=true;score+=50;addP(c.x+8,c.y+8,"#ffd700",6);}
  }

  for(var i=parts.length-1;i>=0;i--){
    var p=parts[i];
    p.x+=p.vx;p.y+=p.vy;p.vy+=0.1;p.life--;
    if(p.life<=0)parts.splice(i,1);
  }

  if(shk>0)shk--;
  document.getElementById("php").style.width=Math.max(0,pl.hp/pl.mhp*100)+"%";
  document.getElementById("stxt").textContent="SCORE: "+score;
  document.getElementById("sttxt").textContent="STAGE "+stg;
  if(pl.hp<=0){state="gameover";showOv();}
}

function draw(){
  ctx.save();
  if(shk>0) ctx.translate((Math.random()-.5)*shk*2,(Math.random()-.5)*shk*2);

  // Sky
  var sg=ctx.createLinearGradient(0,0,0,H);
  var sc=[["#0d0d2b","#1a0533","#2d1b69"],["#0a0a1e","#0d1b3a","#1a2a4a"],["#1a0000","#2a0505","#3a0a0a"]][stg-1];
  sg.addColorStop(0,sc[0]);sg.addColorStop(0.5,sc[1]);sg.addColorStop(1,sc[2]);
  ctx.fillStyle=sg;ctx.fillRect(0,0,W,H);

  // Stars
  ctx.fillStyle="#fff";
  for(var i=0;i<40;i++){
    var sx=((i*137+41)%W+camX*0.05)%W;
    var sy=(i*97+23)%(H*0.4);
    var sa=0.3+Math.sin(fr*0.03+i)*0.3;
    ctx.globalAlpha=Math.max(0,sa);
    ctx.fillRect(sx,sy,1.5,1.5);
  }
  ctx.globalAlpha=1;

  // Mountains
  ctx.fillStyle=["#1a1a2e","#16213e","#2a0a0a"][stg-1];
  for(var i=0;i<10;i++){
    var mx=i*200-(camX*0.15)%200;
    var mh=70+Math.sin(i*1.3)*40;
    ctx.beginPath();ctx.moveTo(mx,GY);ctx.lineTo(mx+100,GY-mh);ctx.lineTo(mx+200,GY);ctx.closePath();ctx.fill();
  }

  // Back trees
  ctx.fillStyle="#0a2e0a";
  for(var i=0;i<16;i++){
    var tx=i*130-(camX*0.25)%130;
    ctx.beginPath();ctx.moveTo(tx+20,GY);ctx.lineTo(tx+40,GY-130+Math.sin(i)*25);ctx.lineTo(tx+60,GY);ctx.closePath();ctx.fill();
  }

  ctx.save();
  ctx.translate(-camX,0);

  // Platforms
  for(var i=0;i<plats.length;i++){
    var p=plats[i];
    if(p.x+p.w<camX-50||p.x>camX+W+50)continue;
    if(p.t==="g"){
      ctx.fillStyle="#5d4037";ctx.fillRect(p.x,p.y,p.w,p.h);
      ctx.fillStyle="#4CAF50";ctx.fillRect(p.x,p.y,p.w,4);
      ctx.fillStyle="#66BB6A";
      for(var g=p.x;g<p.x+p.w;g+=7) ctx.fillRect(g,p.y-2,2,4);
    }else{
      ctx.fillStyle="#6d4c41";ctx.fillRect(p.x,p.y,p.w,p.h);
      ctx.fillStyle="#8D6E63";ctx.fillRect(p.x,p.y,p.w,3);
    }
  }

  // Coins
  for(var i=0;i<coins.length;i++){
    var c=coins[i];
    if(c.got)continue;
    var by2=Math.sin(fr*0.08+c.x)*3;
    ctx.fillStyle="#ffd700";ctx.beginPath();ctx.arc(c.x+8,c.y+8+by2,7,0,Math.PI*2);ctx.fill();
    ctx.fillStyle="#ffeb3b";ctx.beginPath();ctx.arc(c.x+6,c.y+6+by2,3,0,Math.PI*2);ctx.fill();
  }

  // Enemies
  for(var i=0;i<ens.length;i++){
    var e=ens[i];
    if(!e.alive)continue;
    if(e.x+e.w<camX-50||e.x>camX+W+50)continue;
    if(e.tp==="slime"){
      ctx.fillStyle=e.col;
      ctx.beginPath();ctx.arc(e.x+e.w/2,e.y+e.h/2,e.w/2+1,0,Math.PI*2);ctx.fill();
      ctx.fillStyle="#fff";ctx.fillRect(e.x+7,e.y+6,5,5);ctx.fillRect(e.x+16,e.y+6,5,5);
      ctx.fillStyle="#000";ctx.fillRect(e.x+9,e.y+8,2,3);ctx.fillRect(e.x+18,e.y+8,2,3);
    }else{
      var wf=Math.sin(e.at*0.3)*10;
      ctx.fillStyle=e.col;
      ctx.beginPath();ctx.moveTo(e.x+e.w/2,e.y+e.h/2);ctx.lineTo(e.x-4,e.y-wf);ctx.lineTo(e.x+6,e.y+4);ctx.closePath();ctx.fill();
      ctx.beginPath();ctx.moveTo(e.x+e.w/2,e.y+e.h/2);ctx.lineTo(e.x+e.w+4,e.y-wf);ctx.lineTo(e.x+e.w-6,e.y+4);ctx.closePath();ctx.fill();
      ctx.beginPath();ctx.arc(e.x+e.w/2,e.y+e.h/2,7,0,Math.PI*2);ctx.fill();
      ctx.fillStyle="#ff0";ctx.fillRect(e.x+9,e.y+6,3,3);ctx.fillRect(e.x+18,e.y+6,3,3);
    }
    if(e.hp<e.mhp){
      ctx.fillStyle="#333";ctx.fillRect(e.x,e.y-8,e.w,3);
      ctx.fillStyle="#e53935";ctx.fillRect(e.x,e.y-8,e.w*(e.hp/e.mhp),3);
    }
  }

  // Boss
  if(boss&&boss.alive){
    var bx=boss.x,by=boss.y,bw=boss.w,bh=boss.h;
    var fl=boss.inv>0&&boss.inv%4<2;
    ctx.globalAlpha=0.15+Math.sin(fr*0.05)*0.08;
    ctx.fillStyle=boss.cl;ctx.beginPath();ctx.arc(bx+bw/2,by+bh/2,bw*0.75,0,Math.PI*2);ctx.fill();
    ctx.globalAlpha=1;
    if(!fl){
      ctx.fillStyle=boss.cl;ctx.fillRect(bx+8,by+12,bw-16,bh-12);
      ctx.beginPath();ctx.arc(bx+bw/2,by+16,bw/3,0,Math.PI*2);ctx.fill();
      ctx.fillStyle="#333";
      ctx.beginPath();ctx.moveTo(bx+12,by+10);ctx.lineTo(bx+5,by-12);ctx.lineTo(bx+20,by+5);ctx.closePath();ctx.fill();
      ctx.beginPath();ctx.moveTo(bx+bw-12,by+10);ctx.lineTo(bx+bw-5,by-12);ctx.lineTo(bx+bw-20,by+5);ctx.closePath();ctx.fill();
      ctx.fillStyle="#ff0";ctx.fillRect(bx+bw/2-11,by+11,5,5);ctx.fillRect(bx+bw/2+6,by+11,5,5);
    }
    for(var i=0;i<boss.proj.length;i++){
      var p=boss.proj[i];
      ctx.fillStyle=stg===3?"#ff4444":"#aa44ff";
      ctx.beginPath();ctx.arc(p.x,p.y,5,0,Math.PI*2);ctx.fill();
    }
  }

  // Player
  if(pl && (pl.inv<=0||pl.inv%4<2)){
    var px=pl.x,py=pl.y;
    ctx.fillStyle="#1565C0";ctx.fillRect(px+4,py+12,20,18);
    ctx.fillStyle="#ffcc80";ctx.beginPath();ctx.arc(px+14,py+8,8,0,Math.PI*2);ctx.fill();
    ctx.fillStyle="#1565C0";ctx.beginPath();ctx.arc(px+14,py+6,8,Math.PI,Math.PI*2);ctx.fill();
    ctx.fillStyle="#ffd700";ctx.fillRect(px+8,py+5,12,2);
    ctx.fillStyle="#fff";ctx.fillRect(px+(pl.fR?14:9),py+7,4,3);
    ctx.fillStyle="#000";ctx.fillRect(px+(pl.fR?15:10),py+8,2,2);
    var la=pl.onG?Math.sin(pl.af*Math.PI/2)*3:2;
    ctx.fillStyle="#0D47A1";ctx.fillRect(px+6,py+30,7,10+la);ctx.fillRect(px+15,py+30,7,10-la);

    if(pl.atk){
      var ang2=(10-pl.atkT)/10*Math.PI*0.65-0.3;
      var dir=pl.fR?1:-1;
      ctx.save();ctx.translate(px+14,py+18);ctx.rotate(dir>0?ang2:Math.PI-ang2);
      ctx.fillStyle="#e0e0e0";ctx.fillRect(0,-2,28,4);
      ctx.fillStyle="#ffd700";ctx.fillRect(26,-3,4,6);
      ctx.fillStyle="#8B4513";ctx.fillRect(-4,-4,6,8);
      ctx.restore();
    }else{
      var sx2=pl.fR?px+22:px-4;
      ctx.fillStyle="#bbb";ctx.fillRect(sx2,py+14,3,20);
      ctx.fillStyle="#8B4513";ctx.fillRect(sx2-2,py+13,7,4);
    }
  }

  ctx.restore(); // camera

  for(var i=0;i<parts.length;i++){
    var p=parts[i];
    ctx.globalAlpha=Math.max(0,p.life/p.ml);
    ctx.fillStyle=p.col;ctx.fillRect(p.x-camX,p.y,p.sz,p.sz);
  }
  ctx.globalAlpha=1;

  ctx.globalAlpha=0.25;ctx.fillStyle="#0a3a0a";
  for(var i=0;i<8;i++){
    var tx=i*240-(camX*0.55)%240;
    ctx.beginPath();ctx.moveTo(tx,H);ctx.lineTo(tx+28,H-110);ctx.lineTo(tx+56,H);ctx.closePath();ctx.fill();
  }
  ctx.globalAlpha=1;
  ctx.restore(); // shake
}

function showOv(){
  var ov=document.getElementById("ov");ov.classList.remove("hidden");
  var t=document.getElementById("ot"),s2=document.getElementById("os"),btn=document.getElementById("sbtn");
  document.getElementById("bossUI").style.display="none";
  if(state==="title"){t.textContent="\u2694 Forest Knight \u2694";s2.textContent="~ \u30D5\u30A1\u30F3\u30BF\u30B8\u30FC\u6A2A\u30B9\u30AF\u30ED\u30FC\u30EB\u30A2\u30AF\u30B7\u30E7\u30F3 ~";btn.textContent="START GAME";}
  else if(state==="gameover"){t.textContent="\uD83D\uDC80 GAME OVER";s2.textContent="SCORE: "+score;btn.textContent="RETRY";}
  else if(state==="stageclear"){t.textContent="\uD83C\uDFC6 STAGE CLEAR!";s2.textContent="STAGE "+stg+" \u5B8C\u4E86\uFF01 SCORE: "+score;btn.textContent="NEXT STAGE";}
  else if(state==="allclear"){t.textContent="\uD83D\uDC51 ALL CLEAR!!";s2.textContent="\u5168\u30B9\u30C6\u30FC\u30B8\u30AF\u30EA\u30A2\uFF01 SCORE: "+score;btn.textContent="PLAY AGAIN";}
}

document.getElementById("sbtn").addEventListener("click",function(){
  if(state==="title"||state==="gameover"||state==="allclear"){score=0;stg=1;}
  else if(state==="stageclear"){stg++;}
  pl=mkPl();mkLv(stg);state="playing";
  document.getElementById("ov").classList.add("hidden");
  document.getElementById("bossUI").style.display="none";
});

function loop(){update();draw();requestAnimationFrame(loop);}

function resize(){
  var gc=document.getElementById("gc");
  var r=Math.min(gc.clientWidth/W,gc.clientHeight/H,1);
  canvas.style.width=W*r+"px";canvas.style.height=H*r+"px";
}
window.addEventListener("resize",resize);resize();
showOv();loop();
})();
</script>

</body>
</html>
